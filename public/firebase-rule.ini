rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // 1. 모의고사 목록 (public_exams)
    // 누구나 읽을 수 있고(read), 쓰기(write)는 불가능 (관리자도 콘솔에서만 수정 권장)
    match /public_exams/{document=**} {
      allow read: if true;
      allow write: if false; 
    }

    // 2. 사용자 데이터 (users)
    // 오직 로그인한 사용자 본인만 자신의 데이터를 읽고 쓸 수 있습니다.
    match /users/{userId}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // 3. 관리자 설정 (settings 컬렉션)
    
    // (1) 전역 설정 (현재 회차 정보 등)
    // 읽기: 누구나 가능 (수험생 화면에서 최신 회차 확인용)
    // 쓰기: DB에 저장된 'admin' 문서의 이메일과 현재 로그인한 이메일이 같을 때만 허용
    match /settings/global {
      allow read: if true;
      allow write: if request.auth != null && 
                   request.auth.token.email == get(/databases/$(database)/documents/settings/admin).data.adminEmail;
    }

    // (2) 관리자 계정 정보
    // 읽기: 로그인한 사용자는 읽기 가능 (admin.html 접속 시 본인이 관리자인지 대조하기 위해 필요)
    // 쓰기: 로그인한 사용자는 쓰기 가능 (초기 설정 및 비밀번호 변경용)
    // *주의: 더 강력한 보안을 원하면, 최초 생성 이후에는 쓰기를 막거나 콘솔에서만 수정하도록 변경 가능
    match /settings/admin {
      allow read, write: if request.auth != null;
    }
  }
}

관리자는 모든 유저를 읽을 수 있도록 예외 규칙을 추가해야 합니다.