<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ê°“í†µê³¼ - ê¸°ì¶œ í•´ì„¤ ì•„ì¹´ì´ë¸Œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- PDF.js ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Nanum+Pen+Script&display=swap');
        
        body { font-family: 'Noto Sans KR', sans-serif; -webkit-tap-highlight-color: transparent; background-color: #F3F4F6; }
        
        .app-container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: #FFFFFF;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }

        /* ì†ê¸€ì”¨ í°íŠ¸ ì ìš©: ì‹¤ì œ ì„ ìƒë‹˜ì´ ì²¨ì‚­í•´ì¤€ ëŠë‚Œ */
        .handwritten { font-family: 'Nanum Pen Script', cursive; font-size: 1.5rem; line-height: 1.3; color: #374151; }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ë¬¸ì œ ë²ˆí˜¸ ë²„íŠ¼ ë””ìì¸ */
        .num-btn {
            aspect-ratio: 1 / 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 18px;
            font-weight: 800;
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 1px solid #F1F5F9;
            background-color: #F8FAFC;
            color: #64748B;
            font-size: 1.1rem;
        }
        .num-btn:active { transform: scale(0.85); background-color: #EEF2FF; color: #4F46E5; border-color: #C7D2FE; }
        
        .question-canvas { width: 100%; height: auto; display: block; }
        .premium-banner { background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 50%, #EC4899 100%); }

        @keyframes bounce-subtle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }
        .animate-bounce-subtle { animation: bounce-subtle 2.5s infinite ease-in-out; }
    </style>
</head>
<body>

    <div class="app-container">
        <!-- ìƒë‹¨ í—¤ë” (Step 2, 3ì—ì„œë§Œ ë…¸ì¶œ) -->
        <header id="app-header" class="hidden bg-white/90 backdrop-blur-md px-5 py-4 flex items-center sticky top-0 z-50 border-b border-gray-100">
            <button onclick="handleBack()" id="back-btn" class="mr-3 p-1.5 hover:bg-gray-100 rounded-full transition-colors">
                <i data-lucide="arrow-left" class="w-6 h-6 text-gray-600"></i>
            </button>
            <div class="flex items-center gap-2.5">
                <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center shadow-lg shadow-indigo-100">
                    <i data-lucide="scroll-text" class="w-4.5 h-4.5 text-white"></i>
                </div>
                <h1 class="text-lg font-black text-gray-900 tracking-tight" id="header-title">ê¸°ì¶œ í•´ì„¤ ì•„ì¹´ì´ë¸Œ</h1>
            </div>
        </header>

        <main id="main-content" class="flex-1 overflow-y-auto hide-scrollbar">
            
            <!-- [View 1] ì‹œí—˜ì§€ ëª©ë¡ -->
            <div id="view-exam-list" class="fade-in p-5 space-y-7">
                <div class="premium-banner rounded-[32px] p-8 text-white shadow-2xl relative overflow-hidden mt-2">
                    <div class="absolute top-0 right-0 w-40 h-40 bg-white opacity-10 rounded-full -mr-16 -mt-16 blur-2xl"></div>
                    <div class="relative z-10">
                        <div class="flex items-center gap-3 mb-4">
                             <div class="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center backdrop-blur-md border border-white/20">
                                <i data-lucide="scroll-text" class="w-4.5 h-4.5 text-white"></i>
                             </div>
                             <h2 class="text-2xl font-black tracking-tight">ê¸°ì¶œ í•´ì„¤ ì•„ì¹´ì´ë¸Œ</h2>
                        </div>
                        <p class="text-indigo-50 text-[13px] font-medium leading-relaxed opacity-90">
                            ë²„ìŠ¤ë‚˜ ì§€í•˜ì²  ì´ë™ ì‹œê°„, í‹ˆìƒˆ ì‹œê°„ì„ í™œìš©í•´<br>
                            ê¸°ì¶œë¬¸ì œë¥¼ í•œ ë¬¸í•­ì”© ì™„ë²½í•˜ê²Œ ë§ˆìŠ¤í„°í•˜ì„¸ìš”!
                        </p>
                        <div class="mt-8 flex items-center gap-2 text-[11px] font-black bg-white text-indigo-700 w-fit px-4 py-2.5 rounded-full shadow-xl shadow-black/20 animate-bounce-subtle border-2 border-white/50">
                            <i data-lucide="sparkles" class="w-4 h-4 text-amber-500 fill-amber-500"></i> 
                            <span>2028 í†µí•©ê³¼í•™ 25ë¬¸í•­ ì™„ë²½ ëŒ€ì‘</span>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <h3 class="font-black text-gray-900 flex items-center gap-2 text-lg px-1">
                        <i data-lucide="layers" class="w-5 h-5 text-indigo-600"></i>
                        í•™ë…„ë„ë³„ ê¸°ì¶œ ë¶„ì„
                    </h3>
                    <div id="exam-list-container" class="grid grid-cols-1 gap-4">
                        <!-- ë°ì´í„°ëŠ” JSì—ì„œ ë¡œë“œ -->
                    </div>
                </div>
            </div>

            <!-- [View 2] ë¬¸í•­ ì„ íƒ ê·¸ë¦¬ë“œ (2ë‹¨ êµ¬ì„± ë°˜ì˜) -->
            <div id="view-num-grid" class="hidden fade-in p-6">
                <div class="bg-indigo-50/50 rounded-[32px] p-7 border border-indigo-100/50 mb-7">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="bg-indigo-600 text-white text-[9px] font-black px-2 py-0.5 rounded-md uppercase tracking-wider">Exam Board</span>
                        <h3 id="grid-title" class="text-xl font-black text-gray-900 tracking-tight">-</h3>
                    </div>
                    <p class="text-[13px] text-gray-500 font-medium leading-tight">ì™¼ìª½ ë‹¨ë¶€í„° ì˜¤ë¥¸ìª½ ë‹¨ ìˆœì„œë¡œ ë°°ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
                <div id="num-grid" class="grid grid-cols-5 gap-3.5 pb-10"></div>
            </div>

            <!-- [View 3] ìƒì„¸ í’€ì´ ë° ì†ê¸€ì”¨ í•´ì„¤ -->
            <div id="view-solve" class="hidden fade-in px-5 py-2">
                <div class="bg-white rounded-[32px] shadow-xl shadow-gray-100 border border-gray-100 p-4 mb-7 overflow-hidden">
                    <div class="flex justify-between items-center px-3 py-3 border-b border-gray-50 mb-4">
                        <div class="flex items-center gap-2">
                            <span id="solve-q-label" class="text-indigo-600 font-black text-xl tracking-tighter">Q 01</span>
                            <span class="text-gray-200 font-thin text-xl">|</span>
                            <span id="solve-q-score" class="text-amber-500 text-xs font-black uppercase">3 Points</span>
                        </div>
                        <button onclick="showStep(2)" class="p-2 hover:bg-gray-50 rounded-full text-gray-400 transition-colors">
                            <i data-lucide="grid" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <!-- ë¬¸ì œ ì´ë¯¸ì§€ ì˜ì—­ -->
                    <div id="canvas-wrapper" class="bg-white rounded-2xl overflow-hidden min-h-[150px] border border-gray-50 flex items-center justify-center">
                        <canvas id="q-canvas" class="question-canvas"></canvas>
                    </div>
                </div>

                <!-- ì†ê¸€ì”¨ í•´ì„¤ ì˜ì—­ -->
                <div id="exp-panel" class="hidden space-y-6 mb-16 fade-in">
                    <div class="bg-emerald-50 border border-emerald-100 p-6 rounded-[28px] shadow-sm flex items-center justify-between">
                        <div>
                            <h4 class="text-emerald-700 font-black text-[10px] mb-1 flex items-center gap-1.5 uppercase tracking-widest">
                                <i data-lucide="check-circle-2" class="w-3.5 h-3.5"></i> Correct Answer
                            </h4>
                            <p id="correct-ans" class="text-4xl font-black text-emerald-600">â‘¢</p>
                        </div>
                        <span id="solve-q-topic" class="text-emerald-600 text-[11px] font-bold bg-white px-3 py-1.5 rounded-full border border-emerald-100 shadow-sm max-w-[150px] truncate">ë‹¨ì›ëª… ì •ë³´</span>
                    </div>

                    <div class="bg-white border-2 border-indigo-50 p-8 rounded-[32px] shadow-2xl relative">
                        <div class="absolute -top-3 left-8 bg-indigo-600 text-white text-[10px] font-black px-4 py-1.5 rounded-full shadow-lg uppercase tracking-widest border-2 border-white">1íƒ€ ê°•ì‚¬'s Note</div>
                        <h4 class="text-gray-400 font-bold text-[9px] mb-5 flex items-center gap-1.5 uppercase tracking-tighter opacity-60">
                            <i data-lucide="pen-tool" class="w-3 h-3 text-indigo-400"></i> ì˜†ì§‘ ì„ ìƒë‹˜ì˜ ì¹œì ˆí•œ ë¹„ë°€ê³¼ì™¸
                        </h4>
                        <!-- ì‹¤ì œ ì†ê¸€ì”¨ ëŠë‚Œ í•´ì„¤ -->
                        <div id="exp-text" class="handwritten text-gray-800 space-y-2">
                            í•´ì„¤ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì´ì•¼!
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- í’€ì´ í™”ë©´ ê³ ì • ë²„íŠ¼ -->
        <div id="solve-footer" class="hidden p-4 bg-white/90 backdrop-blur-xl border-t border-gray-100 flex gap-2.5 sticky bottom-[72px] z-[40]">
            <button id="btn-show-ans" onclick="toggleExp()" class="flex-1 bg-indigo-600 text-white h-15 py-4 rounded-[22px] font-black text-sm shadow-xl shadow-indigo-100 active:scale-95 transition-all flex items-center justify-center gap-2">
                <i data-lucide="eye" class="w-4 h-4"></i> <span>ì •ë‹µ ë° í•´ì„¤ ë³´ê¸°</span>
            </button>
            <button onclick="nextQuestion()" class="w-15 px-4 bg-gray-900 text-white rounded-[22px] flex items-center justify-center active:scale-95 transition-all shadow-lg">
                <i data-lucide="chevron-right" class="w-6 h-6"></i>
            </button>
        </div>

        <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="bg-white border-t border-gray-100 px-6 py-3 flex justify-between items-center sticky bottom-0 w-full z-50 pb-6 shadow-[0_-5px_15px_rgba(0,0,0,0.02)]">
            <button onclick="location.href='../index.html'" class="nav-btn text-gray-400 flex flex-col items-center gap-1 transition-colors">
                <i data-lucide="home" class="w-6 h-6"></i>
                <span class="text-[10px] font-bold">í™ˆ</span>
            </button>
            <button onclick="location.href='../STEST/exam.html'" class="nav-btn text-gray-400 flex flex-col items-center gap-1 transition-colors">
                <i data-lucide="file-text" class="w-6 h-6"></i>
                <span class="text-[10px] font-bold">ì‹œí—˜ì‘ì‹œ</span>
            </button>
            <button onclick="location.href='../Q-Bank/student_quiz.html'" class="nav-btn flex flex-col items-center gap-1 -mt-8 group">
                <div class="bg-gray-900 p-4 rounded-full shadow-lg shadow-gray-300 group-hover:scale-105 transition-transform group-active:scale-95 border-4 border-white">
                    <i data-lucide="brain-circuit" class="w-7 h-7 text-white"></i>
                </div>
                <span class="text-[10px] font-bold text-gray-600 mt-1">ë¬¸ì œì€í–‰</span>
            </button>
            <button onclick="location.href='../STEST/exam.html?view=report'" class="nav-btn text-gray-400 flex flex-col items-center gap-1 transition-colors">
                <i data-lucide="bar-chart-2" class="w-6 h-6"></i>
                <span class="text-[10px] font-bold">ì„±ì ë¶„ì„</span>
            </button>
            <button onclick="location.href='../index.html?view=market'" class="nav-btn text-gray-400 flex flex-col items-center gap-1 transition-colors">
                <i data-lucide="user" class="w-6 h-6"></i>
                <span class="text-[10px] font-bold">ë§ˆì´</span>
            </button>
        </nav>
    </div>

    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div id="loading" class="hidden fixed inset-0 bg-white/95 z-[100] flex flex-col items-center justify-center text-indigo-600">
        <div class="w-14 h-14 border-[5px] border-indigo-600 border-t-transparent rounded-full animate-spin mb-6 shadow-2xl"></div>
        <p class="font-black text-sm tracking-tight text-gray-900" id="loading-text">ê¸°ì¶œ ë°ì´í„°ë¥¼ ì •ë°€ ë¶„ì„ ì¤‘...</p>
    </div>

    <script type="module">
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // [í•µì‹¬ ë°ì´í„°ë² ì´ìŠ¤] 2ë‹¨ êµ¬ì„±ì„ ê³ ë ¤í•œ ì¢Œí‘œ ë°ì´í„° ì˜ˆì‹œ
        // rect: [x_ratio, y_ratio, width_ratio, height_ratio]
        const EXAM_DATABASE = {
            "2028_PRETEST": {
                title: "2028 í†µí•©ê³¼í•™ ì˜ˆë¹„ë¬¸í•­",
                pdfFile: "2028_pretest.pdf",
                total: 25,
                coords: {
                    // ì™¼ìª½ ë‹¨ (0.0 ~ 0.5), ì˜¤ë¥¸ìª½ ë‹¨ (0.5 ~ 1.0)
                    1: { p: 1, rect: [0.05, 0.08, 0.44, 0.35], ans: "â‘¢", score: 2, topic: "ë¬¼ì§ˆì˜ ê·œì¹™ì„±" },
                    2: { p: 1, rect: [0.05, 0.45, 0.44, 0.45], ans: "â‘¤", score: 3, topic: "ì‹œìŠ¤í…œê³¼ ìƒí˜¸ì‘ìš©" },
                    3: { p: 1, rect: [0.51, 0.08, 0.44, 0.40], ans: "â‘ ", score: 2, topic: "ë³„ì˜ ì§„í™”" },
                    4: { p: 1, rect: [0.51, 0.50, 0.44, 0.40], ans: "â‘¡", score: 3, topic: "ì¤‘ë ¥ì¥ ìš´ë™" },
                    // ... 25ë²ˆê¹Œì§€ ë™ì¼í•œ íŒ¨í„´ìœ¼ë¡œ ì™¼ìª½ë‹¨ ë¨¼ì € ì±„ìš°ê³  ì˜¤ë¥¸ìª½ë‹¨ ì±„ìš°ëŠ” ë°ì´í„° í•„ìš”
                },
                explanations: {
                    1: "ì•ˆë…•! ìˆ˜ëŠ¥ 1ë²ˆì€ ì–¸ì œë‚˜ ì„¤ë ˆì§€? ì´ ë¬¸ì œëŠ” <b>ì›ì†Œì˜ ì£¼ê¸°ì„±</b>ì„ ë¬»ê³  ìˆì–´.<br>í•µì‹¬ì€ <span class='text-red-500'>ì›ìê°€ ì „ì ìˆ˜</span>ê°€ ê°™ìœ¼ë©´ í™”í•™ì  ì„±ì§ˆì´ ë¹„ìŠ·í•˜ë‹¤ëŠ” ê±°ì•¼. ì£¼ê¸°ìœ¨í‘œë¥¼ ë‹¤ì‹œ í•œë²ˆ ë¨¸ë¦¿ì†ì— ê·¸ë ¤ë´! í•  ìˆ˜ ìˆì§€?",
                    2: "ì, 2ë²ˆì€ <b>ì¤‘ë ¥ì¥ ë‚´ì˜ ìš´ë™</b>ì´ë„¤. (ğŸ‘€ ê·¸ë¦¼ í™•ì¸ í•„ìš”!) <br>ê·¸ë˜í”„ì˜ ê¸°ìš¸ê¸°ê°€ ë¬´ì—‡ì„ ì˜ë¯¸í• ê¹Œ? ë°”ë¡œ <span class='text-red-500'>ê°€ì†ë„</span>ì•¼! ì§ˆëŸ‰ì´ ì¼ì •í•  ë•Œ í˜ê³¼ ê°€ì†ë„ëŠ” ë¹„ë¡€í•œë‹¤ëŠ” ì  ìŠì§€ ë§ˆ. í—·ê°ˆë ¸ì§€? ê´œì°®ì•„, ë‹¤ì‹œ ë³´ë©´ ë³´ì—¬!",
                    3: "<b>ë³„ì˜ ì§„í™”</b> ê³¼ì •ì€ ìˆœì„œê°€ ì •ë§ ì¤‘ìš”í•´.<br>ì£¼ê³„ì—´ì„± ë‹¤ìŒì—” ë­ê°€ ì˜¤ì§€? ë§ì•„, ì ìƒ‰ ê±°ì„±ì´ì•¼. <span class='text-red-500'>ì¤‘ë ¥ ìˆ˜ì¶•ê³¼ ë‚´ë¶€ ì••ë ¥</span>ì˜ ê· í˜•ì„ ì˜ ìƒê°í•´ë³´ë ´. ìˆ˜ëŠ¥ì—ì„œ ë¬´ì¡°ê±´ ë‚˜ì˜¤ëŠ” ë‹¨ê³¨ ì†ë‹˜ì´ì•¼!",
                    4: "ì´ ë¬¸ì œëŠ” íƒêµ¬ ìˆ˜í–‰ ê³¼ì •ì´ë„¤.<br>ê°€ì„¤ì´ ë§ëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ <span class='text-red-500'>ë³€ì¸ í†µì œ</span>ë¥¼ ì™„ë²½í•˜ê²Œ í•´ì•¼ í•´. ì–´ë–¤ ë³€ì¸ì„ ì¼ì •í•˜ê²Œ ë‘ì—ˆëŠ”ì§€ ì˜ ì‚´í´ë´! ê¼¼ê¼¼í•¨ì´ 1ë“±ê¸‰ì„ ë§Œë“ ë‹¨ë‹¤. ì‘ì›í• ê²Œ!"
                }
            },
            "2024_CSAT": {
                title: "2024í•™ë…„ë„ ìˆ˜ëŠ¥ ê¸°ì¶œ",
                pdfFile: "2024_csat.pdf",
                total: 20,
                coords: {
                    1: { p: 1, rect: [0.05, 0.08, 0.44, 0.30], ans: "â‘£", score: 2, topic: "ìƒëª… ì‹œìŠ¤í…œ" }
                },
                explanations: {
                    1: "ìˆ˜ëŠ¥ì˜ ì‹œì‘ 1ë²ˆ! <b>ë¦¬ë³´ì†œ</b>ì˜ ê¸°ëŠ¥ì€ ë‹¨ë°±ì§ˆ í•©ì„±ì´ì§€.<br>ì„¸í¬ ì†Œê¸°ê´€ì˜ íŠ¹ì§•ì„ ë¬»ëŠ” ë¬¸ì œëŠ” ì ˆëŒ€ í‹€ë¦¬ë©´ ì•ˆ ë¼. <span class='text-red-500'>ê¸°ë³¸ì´ ê°€ì¥ ê°•ë ¥í•œ ë¬´ê¸°</span>ë¼ëŠ” ì‚¬ì‹¤! ìì‹  ìˆê²Œ í’€ì–´ë³´ì!"
                }
            }
        };

        let currentExamId = null;
        let currentQNum = 0;
        let pdfDoc = null;
        let currentStep = 1; // 1: List, 2: Grid, 3: Solve

        // ì´ˆê¸° ëª©ë¡ ìƒì„±
        function renderExamList() {
            const container = document.getElementById('exam-list-container');
            container.innerHTML = '';
            Object.keys(EXAM_DATABASE).forEach(id => {
                const exam = EXAM_DATABASE[id];
                const is2028 = id.includes('2028');
                container.innerHTML += `
                    <button onclick="selectExam('${id}')" class="bg-white border border-gray-100 p-5 rounded-[32px] text-left hover:border-indigo-400 transition-all shadow-sm active:scale-[0.97] group relative overflow-hidden">
                        <div class="flex justify-between items-center mb-3">
                            <span class="${is2028 ? 'bg-indigo-50 text-indigo-700' : 'bg-red-50 text-red-700'} text-[10px] font-black px-3 py-1 rounded-full border border-opacity-20">
                                ${is2028 ? 'PREMIUM ANALYSIS' : 'OFFICIAL CSAT'}
                            </span>
                            <div class="bg-gray-50 p-2 rounded-full group-hover:bg-indigo-600 group-hover:text-white transition-all">
                                <i data-lucide="arrow-right" class="w-4 h-4"></i>
                            </div>
                        </div>
                        <h4 class="font-black text-gray-900 text-xl tracking-tight">${exam.title}</h4>
                    </button>
                `;
            });
            lucide.createIcons();
        }

        window.selectExam = async (id) => {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('loading-text').innerText = "ì‹œí—˜ì§€ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
            currentExamId = id;
            const exam = EXAM_DATABASE[id];
            
            try {
                // PDF ë¡œë“œ
                const loadingTask = pdfjsLib.getDocument(exam.pdfFile);
                pdfDoc = await loadingTask.promise;
                initNumGrid(exam.total);
                showStep(2);
            } catch(e) {
                console.error(e);
                alert("PDF íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. archive í´ë”ì— íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸í•´ì¤˜!");
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        };

        function initNumGrid(count) {
            const container = document.getElementById('num-grid');
            container.innerHTML = '';
            for(let i=1; i<=count; i++) {
                const btn = document.createElement('button');
                btn.className = "num-btn shadow-sm";
                btn.innerText = i;
                btn.onclick = () => loadQuestion(i);
                container.appendChild(btn);
            }
        }

        window.loadQuestion = async (num) => {
            currentQNum = num;
            const exam = EXAM_DATABASE[currentExamId];
            const qData = exam.coords[num];
            
            if(!qData) {
                alert("í•´ë‹¹ ë¬¸í•­ì˜ ë°ì´í„°ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ì–´. ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì¤˜!");
                return;
            }
            
            document.getElementById('solve-q-label').innerText = `Q ${String(num).padStart(2, '0')}`;
            document.getElementById('solve-q-score').innerText = `${qData.score} Points`;
            document.getElementById('solve-q-topic').innerText = qData.topic;
            document.getElementById('correct-ans').innerText = qData.ans;
            document.getElementById('exp-text').innerHTML = exam.explanations[num] || "ì„ ìƒë‹˜ì´ ì—´ì‹¬íˆ í•´ì„¤ì„ ì“°ê³  ìˆì–´! ê¸ˆë°© ì•Œë ¤ì¤„ê²Œ.";
            
            document.getElementById('exp-panel').classList.add('hidden');
            document.getElementById('btn-show-ans').innerHTML = `<i data-lucide="eye" class="w-4 h-4"></i> <span>ì •ë‹µ ë° í•´ì„¤ ë³´ê¸°</span>`;
            
            await renderQuestionCrop(qData);
            showStep(3);
            lucide.createIcons();
        };

        // í•µì‹¬: 2ë‹¨ êµ¬ì„±ì„ ì§€ì›í•˜ëŠ” ê³ í•´ìƒë„ í¬ë¡­ ë Œë”ë§
        async function renderQuestionCrop(qData) {
            const canvas = document.getElementById('q-canvas');
            const ctx = canvas.getContext('2d');
            const page = await pdfDoc.getPage(qData.p);
            
            const scale = 3.5; // ê°€ë¡œ í¬ë¡­ ì‹œ ê°€ë…ì„±ì„ ìœ„í•œ ê³ ë°°ìœ¨
            const viewport = page.getViewport({ scale });
            
            const [rx, ry, rw, rh] = qData.rect;
            const x = rx * viewport.width;
            const y = ry * viewport.height;
            const w = rw * viewport.width;
            const h = rh * viewport.height;

            canvas.width = w;
            canvas.height = h;

            // ì„ì‹œ ì˜¤í”„ìŠ¤í¬ë¦° ìº”ë²„ìŠ¤ì— ë Œë”ë§ í›„ í•„ìš”í•œ ì˜ì—­ë§Œ ë³µì‚¬
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = viewport.width;
            tempCanvas.height = viewport.height;
            const tempCtx = tempCanvas.getContext('2d');
            
            await page.render({ canvasContext: tempCtx, viewport }).promise;
            ctx.drawImage(tempCanvas, x, y, w, h, 0, 0, w, h);
        }

        window.toggleExp = () => {
            const panel = document.getElementById('exp-panel');
            const btn = document.getElementById('btn-show-ans');
            if(panel.classList.contains('hidden')) {
                panel.classList.remove('hidden');
                btn.innerHTML = `<i data-lucide="eye-off" class="w-4 h-4"></i> <span>í•´ì„¤ ë‹«ê¸°</span>`;
                setTimeout(() => {
                    panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            } else {
                panel.classList.add('hidden');
                btn.innerHTML = `<i data-lucide="eye" class="w-4 h-4"></i> <span>ì •ë‹µ ë° í•´ì„¤ ë³´ê¸°</span>`;
            }
            lucide.createIcons();
        };

        window.nextQuestion = () => {
            const exam = EXAM_DATABASE[currentExamId];
            if(currentQNum < exam.total) loadQuestion(currentQNum + 1);
            else { alert("ì˜¤ëŠ˜ì˜ ê¸°ì¶œ í•™ìŠµ ì™„ë£Œ! ì •ë§ ë©‹ì§€ë‹¤ ì¹œêµ¬ì•¼!"); showStep(2); }
        };

        window.handleBack = () => {
            if(currentStep === 3) showStep(2);
            else if(currentStep === 2) showStep(1);
        };

        window.showStep = (step) => {
            currentStep = step;
            const header = document.getElementById('app-header');
            document.getElementById('view-exam-list').classList.add('hidden');
            document.getElementById('view-num-grid').classList.add('hidden');
            document.getElementById('view-solve').classList.add('hidden');
            document.getElementById('solve-footer').classList.add('hidden');

            if(step === 1) {
                header.classList.add('hidden');
                document.getElementById('view-exam-list').classList.remove('hidden');
            } else if(step === 2) {
                header.classList.remove('hidden');
                document.getElementById('view-num-grid').classList.remove('hidden');
                document.getElementById('header-title').innerText = EXAM_DATABASE[currentExamId].title;
            } else if(step === 3) {
                header.classList.remove('hidden');
                document.getElementById('view-solve').classList.remove('hidden');
                document.getElementById('solve-footer').classList.remove('hidden');
            }
            lucide.createIcons();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        renderExamList();
        lucide.createIcons();
    </script>
</body>
</html>