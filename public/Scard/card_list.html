<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>용어 암기장 목록</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* 스크롤바 숨기기 */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* 아코디언 애니메이션 */
        .accordion-content {
            transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease-in-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        .accordion-content.open {
            max-height: 1000px; /* 충분히 큰 값 */
            opacity: 1;
        }
        
        /* 아이콘 회전 */
        .chevron-icon { transition: transform 0.3s; }
        .chevron-icon.rotate { transform: rotate(180deg); }

        /* 카드 터치 효과 */
        .topic-card:active { transform: scale(0.96); }

        /* 애니메이션 */
        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="max-w-[480px] mx-auto min-h-screen bg-[#F9FAFB] relative flex flex-col shadow-2xl">
        <header class="bg-white/90 backdrop-blur-md px-5 py-4 flex items-center sticky top-0 z-50 border-b border-gray-100 shadow-sm">
            <button onclick="location.href='../index.html'" class="p-2 -ml-2 mr-2 hover:bg-gray-100 rounded-full transition-colors text-gray-600">
                <i data-lucide="arrow-left" class="w-6 h-6"></i>
            </button>
            <div>
                <h1 class="text-xl font-black text-gray-900 tracking-tight">용어 암기장</h1>
                <p class="text-[10px] text-gray-500 font-medium">단원을 선택하여 학습하세요</p>
            </div>
        </header>

        <main class="flex-1 p-4 pb-24 overflow-y-auto hide-scrollbar" id="main-list">
            </main>

        <nav class="bg-white border-t border-gray-100 px-6 py-3 flex justify-between items-center fixed bottom-0 w-full max-w-[480px] z-50 pb-6 shadow-[0_-5px_15px_rgba(0,0,0,0.02)]">
            <button onclick="location.href='../index.html'" class="nav-btn text-gray-400 flex flex-col items-center gap-1 hover:text-gray-600 transition-colors">
                <i data-lucide="home" class="w-6 h-6"></i>
                <span class="text-[10px] font-bold">홈</span>
            </button>
            
            <button onclick="location.href='../STEST/exam.html'" class="nav-btn text-gray-400 flex flex-col items-center gap-1 transition-colors">
                <i data-lucide="file-text" class="w-6 h-6"></i>
                <span class="text-[10px] font-bold">시험응시</span>
            </button>
            
            <button onclick="location.href='../Q-Bank/student_quiz.html'" class="nav-btn flex flex-col items-center gap-1 -mt-8 group">
                <div class="bg-gray-900 p-4 rounded-full shadow-lg shadow-gray-300 group-hover:scale-105 transition-transform group-active:scale-95 border-4 border-white">
                    <i data-lucide="brain-circuit" class="w-7 h-7 text-white"></i>
                </div>
                <span class="text-[10px] font-bold text-gray-600 mt-1">문제은행</span>
            </button>
            
            <button onclick="location.href='../STEST/exam.html?view=report'" class="nav-btn text-gray-400 flex flex-col items-center gap-1 transition-colors">
                <i data-lucide="bar-chart-2" class="w-6 h-6"></i>
                <span class="text-[10px] font-bold">성적분석</span>
            </button>
            
            <button onclick="renderMarket()" class="nav-btn text-gray-400 flex flex-col items-center gap-1 transition-colors">
                <i data-lucide="user" class="w-6 h-6"></i>
                <span class="text-[10px] font-bold">마이</span>
            </button>
        </nav>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD5axOHuQQ9Y5VmIqvN1AeuVyAVivQlTXs",
            authDomain: "godtonggwa.firebaseapp.com",
            projectId: "godtonggwa",
            storageBucket: "godtonggwa.firebasestorage.app",
            messagingSenderId: "1087434066468",
            appId: "1:1087434066468:web:00a75c9329543afc76e6b1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // 전역 변수 설정
        window.auth = auth;
        window.db = db;
        
        let currentUser = null;
        let userData = null;

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                try {
                    const userDoc = await getDoc(doc(db, "users", user.uid));
                    if(userDoc.exists()) {
                        userData = userDoc.data();
                    }
                } catch(e) { console.error("User Load Error:", e); }
                
                // 마이페이지가 열려있는 상태라면 정보 갱신
                if (document.getElementById('mypage-user-name')) {
                    renderMarket();
                }
            } else {
                currentUser = null;
                userData = null;
            }
        });

        window.handleLogout = () => {
            if(confirm("정말 로그아웃 하시겠습니까?")) {
                signOut(auth).then(() => {
                    alert("로그아웃 되었습니다.");
                    location.reload(); // 리스트 페이지 새로고침
                }).catch((error) => {
                    console.error("Logout Error:", error);
                });
            }
        };

        window.updateUserInfo = async () => {
            if(!currentUser) return alert("로그인이 필요합니다.");
            const newName = prompt("변경할 닉네임을 입력:", userData.name);
            if(newName && newName.trim()) {
                try { await updateDoc(doc(db, "users", currentUser.uid), { name: newName.trim() }); userData.name = newName.trim(); alert("변경 완료"); renderMarket(); }
                catch(e) { console.error(e); }
            }
        };

        window.manageSubscription = () => { if(!currentUser) return alert("로그인 필요"); alert(userData.isPaid ? "프리미엄 이용 중" : "관리자 문의 필요"); };

        // 네비게이션 업데이트 함수
        window.updateNav = function(activeName) {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                const text = btn.querySelector('span').innerText;
                if(text === activeName) { btn.classList.remove('text-gray-400'); btn.classList.add('text-indigo-600'); }
                else { btn.classList.remove('text-indigo-600'); btn.classList.add('text-gray-400'); }
            });
        }

        // 마이페이지 렌더링 함수 (index.html과 동일한 로직, 대상 ID만 조정)
        window.renderMarket = function() {
            updateNav('마이');
            const main = document.getElementById('main-list'); // 리스트 영역을 덮어씀
            
            const userName = userData ? userData.name : '비회원';
            let userPlan = userData && userData.isPaid ? '프리미엄' : '일반';
            const loginBtn = currentUser ? `<button onclick="handleLogout()" class="text-xs text-gray-500 underline ml-auto">로그아웃</button>` : `<button onclick="location.href='../STEST/exam.html'" class="text-xs text-indigo-600 font-bold ml-auto">로그인</button>`;
            
            main.innerHTML = `
                <div class="fade-in space-y-4 pt-10 px-2" id="mypage-user-name">
                    <h2 class="text-xl font-bold text-gray-800 flex justify-between items-center">마이페이지 ${loginBtn}</h2>
                    <div class="bg-white p-4 rounded-xl border border-gray-100 flex items-center gap-4 shadow-sm">
                        <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center text-gray-400"><i data-lucide="user" class="w-6 h-6"></i></div>
                        <div><p class="font-bold text-lg">${userName}님</p><p class="text-xs text-gray-500">${userPlan}</p></div>
                    </div>
                    <div class="space-y-3 mt-6">
                         <div onclick="updateUserInfo()" class="bg-white p-4 rounded-xl border border-gray-100 flex justify-between items-center cursor-pointer hover:bg-gray-50"><div class="flex items-center gap-3"><i data-lucide="edit-3" class="w-4 h-4 text-blue-500"></i><span class="text-sm">내 정보 수정</span></div></div>
                         <div onclick="manageSubscription()" class="bg-white p-4 rounded-xl border border-gray-100 flex justify-between items-center cursor-pointer hover:bg-gray-50"><div class="flex items-center gap-3"><i data-lucide="credit-card" class="w-4 h-4 text-purple-500"></i><span class="text-sm">이용권 관리</span></div></div>
                    </div>
                    <div class="mt-8 text-center">
                        <button onclick="location.reload()" class="text-sm text-gray-500 underline">암기장 목록으로 돌아가기</button>
                    </div>
                </div>`;
            lucide.createIcons();
        }
    </script>

    <script>
        // 데이터 정의 (35개 전체 주제)
        const curriculum = [
            {
                unit: "0. 기초 및 첨단과학",
                color: "from-indigo-500 to-purple-500",
                bg: "bg-indigo-50",
                text: "text-indigo-600",
                icon: "microscope",
                items: [
                    { title: "기본량과 단위", sub: "SI 단위계", file: "1-1_scard.html", icon: "ruler" },
                    { title: "측정과 어림", sub: "유효숫자", file: "1-2_scard.html", icon: "pencil-ruler" },
                    { title: "정보와 신호", sub: "디지털 변환", file: "1-3_scard.html", icon: "radio" },
                    { title: "감염병과 병원체", sub: "병원체", file: "6-1_scard.html", icon: "brain-circuit" },
                    { title: "인공지능과 과학 탐구", sub: "머신러닝", file: "6-2_scard.html", icon: "bot" },
                    { title: "로봇", sub: "로봇 공학", file: "6-3_scard.html", icon: "shield-check" },
                    { title: "과학기술과 윤리", sub: "연구 진실성", file: "6-4_scard.html", icon: "bug" }
                ]
            },
            {
                unit: "1. 물질과 규칙성",
                color: "from-pink-500 to-rose-500",
                bg: "bg-pink-50",
                text: "text-pink-600",
                icon: "atom",
                items: [
                    { title: "원소 형성", sub: "빅뱅 우주론", file: "2-1_scard.html", icon: "sparkles" },
                    { title: "별의 진화", sub: "별의 일생과 태양계", file: "2-2_scard.html", icon: "star" },
                    { title: "원소의 주기성", sub: "주기율표", file: "2-3_scard.html", icon: "table-2" },
                    { title: "이온 결합", sub: "금속+비금속", file: "2-4_scard.html", icon: "zap" },
                    { title: "공유 결합", sub: "비금속끼리", file: "2-5_scard.html", icon: "link" },
                    { title: "지각과 생명체 구성 물질의 규칙성", sub: "구성 물질", file: "2-6_scard.html", icon: "mountain" },
                    { title: "물질의 전기적 성질", sub: "신소재", file: "2-7_scard.html", icon: "cpu" }
                ]
            },
            {
                unit: "2. 시스템과 상호작용",
                color: "from-green-500 to-teal-500",
                bg: "bg-green-50",
                text: "text-green-600",
                icon: "activity",
                items: [
                    { title: "지구 시스템의 구성과 상호작용", sub: "구성 요소", file: "3-1_scard.html", icon: "globe" },
                    { title: "판 구조론", sub: "지각 변동", file: "3-2_scard.html", icon: "map" },
                    { title: "중력장 내의 운동", sub: "자유 낙하", file: "3-3_scard.html", icon: "arrow-down" },
                    { title: "충격량과 운동량", sub: "충격량", file: "3-4_scard.html", icon: "car" },
                    { title: "생명 시스템의 기본 단위", sub: "세포막", file: "3-5_scard.html", icon: "dna" },
                    { title: "물질대사", sub: "효소", file: "3-6_scard.html", icon: "flask-conical" },
                    { title: "유전자와 단백질", sub: "중심 원리", file: "3-7_scard.html", icon: "file-code" }
                ]
            },
            {
                unit: "3. 변화와 다양성",
                color: "from-yellow-500 to-orange-500",
                bg: "bg-yellow-50",
                text: "text-orange-600",
                icon: "layers",
                items: [
                    { title: "지질시대의 생물과 화석", sub: "화석", file: "4-1_scard.html", icon: "hourglass" },
                    { title: "지질시대 환경 변화와 대멸종", sub: "환경 변화", file: "4-2_scard.html", icon: "skull" },
                    { title: "자연선택", sub: "자연 선택", file: "4-3_scard.html", icon: "git-branch" },
                    { title: "생물다양성", sub: "보전", file: "4-4_scard.html", icon: "flower" },
                    { title: "산화와 환원", sub: "전자 이동", file: "4-5_scard.html", icon: "flame" },
                    { title: "산성과 염기성", sub: "성질", file: "4-6_scard.html", icon: "beaker" },
                    { title: "중화 반응", sub: "H+와 OH-", file: "4-7_scard.html", icon: "droplets" },
                    { title: "물질 변화에서 에너지 출입", sub: "발열과 흡열", file: "4-8_scard.html", icon: "thermometer" }
                ]
            },
            {
                unit: "4. 환경과 에너지",
                color: "from-blue-500 to-cyan-500",
                bg: "bg-blue-50",
                text: "text-blue-600",
                icon: "zap",
                items: [
                    { title: "생태계 구성 요소", sub: "생태계 구성 단계", file: "5-1_scard.html", icon: "scale" },
                    { title: "생태계 평형", sub: "먹이 그물", file: "5-2_scard.html", icon: "scale" },
                    { title: "대기와 해양의 상호작용", sub: "엘니뇨", file: "5-3_scard.html", icon: "waves" },
                    { title: "온실기체와 지구 온난화", sub: "기후 변화", file: "5-4_scard.html", icon: "sun" },
                    { title: "핵융합", sub: "인공 태양", file: "5-5_scard.html", icon: "infinity" },
                    { title: "발전", sub: "전자기 유도", file: "5-6_scard.html", icon: "lightbulb" },
                    { title: "에너지 전환과 효율", sub: "보존과 절약", file: "5-7_scard.html", icon: "battery-charging" }
                ]
            }
        ];

        // 렌더링 함수
        function renderList() {
            const container = document.getElementById('main-list');
            let html = '';

            curriculum.forEach((section, index) => {
                const isOpen = index === 0 ? 'open' : ''; // 첫 번째 섹션만 열어둠
                const isRotated = index === 0 ? 'rotate' : '';
                
                // 대단원 헤더 (아코디언)
                html += `
                <div class="mb-4 bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-4 flex justify-between items-center cursor-pointer active:bg-gray-50 transition-colors" onclick="toggleAccordion(${index})">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br ${section.color} flex items-center justify-center text-white shadow-sm">
                                <i data-lucide="${section.icon}" class="w-5 h-5"></i>
                            </div>
                            <h2 class="font-bold text-gray-800 text-lg tracking-tight">${section.unit}</h2>
                        </div>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 chevron-icon ${isRotated}" id="icon-${index}"></i>
                    </div>
                    
                    <div id="content-${index}" class="accordion-content ${isOpen} bg-gray-50/50">
                        <div class="p-3 grid grid-cols-2 gap-3">
                            ${section.items.map(item => `
                                <div onclick="location.href='${item.file}'" class="topic-card bg-white p-3 rounded-xl border border-gray-200 shadow-sm cursor-pointer flex flex-col gap-2 hover:border-indigo-200 transition-all">
                                    <div class="flex justify-between items-start">
                                        <div class="p-2 ${section.bg} rounded-lg ${section.text}">
                                            <i data-lucide="${item.icon}" class="w-4 h-4"></i>
                                        </div>
                                        <i data-lucide="arrow-right" class="w-3 h-3 text-gray-300"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-bold text-sm text-gray-800 leading-tight">${item.title}</h3>
                                        <p class="text-[10px] text-gray-500 mt-0.5">${item.sub}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>`;
            });

            container.innerHTML = html;
            lucide.createIcons();
        }

        // 아코디언 토글 함수
        function toggleAccordion(index) {
            const content = document.getElementById(`content-${index}`);
            const icon = document.getElementById(`icon-${index}`);
            
            content.classList.toggle('open');
            icon.classList.toggle('rotate');
        }

        // 초기 실행
        renderList();
    </script>
</body>
</html>